# 年齢当て問題の関数化

## 関数化とは？

プログラムの関数化は、コードを小さな部品に分割し、それぞれの部品が特定の処理を実行できるようにすることです。関数化はコードの再利用性のしやすさ、プログラムの管理のしやすさ、理解しやすさを向上させることができます。

実際に年齢あて問題をプログラムで実装して、それを関数化してみましょう！


## 年齢あて問題の実装アルゴリズム

まず年齢を当てるアルゴリズム（計算手順）を考えてみましょう！ここでは最高年齢は100歳までとします。

様々な方法がありますが、最も簡単に考えられるのは**0歳から100歳までを順番に聞いていく**方法です。このような方法を**全探索**といいます。しかし、この方法だと毎回年齢を当てたい人に質問する必要があるため、時間もかかるし、質問する人も疲れてしまいますよね.......

そこで！今回は**二分探索**という方法で問題を解いてみようと思います！簡単に説明すると、二分探索は「二つに分けて探す」という考え方を使います。

例えば、**1から10**までの数字が順番に並んでいるとき、**7**を探したいとしましょう。この場合、1から10までの数字を**2**つのグループに分けます。**1から5まで**と**6から10まで**です。7は6から10までの中にあるので、6から10の中で、もう一度二分探索を行います。

6から10を二つのグループに分けると、**6から8まで**と**9から10まで**に分けられます。7は6から8までの中にあるので6から8の間でもう一度二分探索を行います。

6から8を二つのグループに分けると、**6,7**と**8**に分けられます。7は6,7のグループにあるのでここから7を探します。

このようにして値を求めていくと探さなければならない範囲が処理をするごとに半分になっていることがわかると思います！！

したがって、二分探索を用いることで、全探索と比べて質問する回数が減り、より早く、質問者もあまり疲れずに年齢を当てることができます！

## 年齢あて問題の実装プログラム
それでは早速コードを実装していきます。まずは**関数化**を行わずに記述していきます！
もとめる年齢は0歳から100歳までで、小さい順に年齢が並んでいるとします!

```python
left = 0#当てる年齢の範囲の右端と左端の値を取得(今回は0歳から100歳まで)
right = 100
display = True#処理状態の表示の有無
count = 0#繰り返し回数を保持
age_found = 0#年齢を見つけられたか調べる。

if display:
  print(f'初めの状態を表示します。')
  print(f" 左端は{left}です。右端は{right}です。")

while left <= right:
   mid = (left + right) // 2#leftとrightの真ん中の値を取得
   if display:#displayにはTrueかFalseが入っているからこれだけでOK
       print(f'現在{count}回目の繰り返しです。')
       print(f" 左端は{left}です。右端は{right}です。真ん中は{mid}です。")
   answer = input(f"あなたの年齢は{mid}歳ですか？(yes/no) ")#真ん中の値が年齢か聞く

   while answer != "yes" and answer != "no":#適切な入力をしないと警告する anserが 'yes' じゃない　かつ　'no'じゃないならエラー
       answer = input("yesかnoで答えてください。")

   if answer == "yes":#yesならそれが年齢
       print(f"あなたの年齢は{mid}歳ですね！")
       age_found = True
       break#年齢がわかったら繰り返しをやめる
   else:
       higher_or_lower = input("それよりも年上(higher)ですか、年下(lower)ですか？(higher/lower) ")

       while higher_or_lower != "higher" and higher_or_lower != "lower":
           higher_or_lower = input("higherかlowerで答えてください。")

       if higher_or_lower == "higher":#真ん中よりも値が大きいならleftをmid+1する
           left = mid + 1
       else:
           right = mid - 1#それ以外ならrightをmid-1する
   count += 1#繰り返しごとに1を足し合わせる。
#設定した範囲内に年齢が無かったら知らせる
if age_found == False:
    print('あなたの年齢は与えられた範囲内にはありません。')
```
いかがでしょうか？実際にコピペして動くか試してみてください！そのあと変数の値をいろいろ変えて試してみてください！

....いや、変数変えて試すの結構めんどくさいな..

試しているうちにこんな考えになってくると思います。そこで！変数の値を**自由**に、**簡単に**変えられれば便利になると思いませんか?

そこで今回の本題の関数化をしていくわけです。

## プログラムの関数化
先ほど作成したプログラムを簡単に調整できるようにプログラムの**関数化**をしていきます。変更点としては関数の引数に先ほどのプログラムのleft,right,count,age,displayを引数にして渡す処理に修正していきます。

```python
def guess_age(left, right, display=False):#displayはFalseで初期化しておく
    count = 0
    if display:
        print(f'初めの状態を表示します。')
        print(f" 左端は{left}です。右端は{right}です。")
    while left <= right:
        mid = (left + right) // 2
        if display:
            print(f'現在{count}回目の繰り返しです。')
            print(f" 左端は{left}です。右端は{right}です。真ん中は{mid}です。")
        answer = input(f"あなたの年齢は{mid}歳ですか？(yes/no) ")

        while answer != "yes" and answer != "no":
            answer = input("yesかnoで答えてください。")

        if answer == "yes":
            return mid#年齢を当てられたら値を返す
        else:
            higher_or_lower = input("それよりも年上(higher)ですか、年下(lower)ですか？(higher/lower) ")

            while higher_or_lower != "higher" and higher_or_lower != "lower":
                higher_or_lower = input("higherかlowerで答えてください。")

            if higher_or_lower == "higher":
                left = mid + 1
            else:
                right = mid - 1
        count += 1
    return None#年齢を探す範囲内に無かったらNoneを返す
```
いかがでしょうか？初めのコードよりもコードがすっきりしたことに加え、関数化することで、再度この処理を容易に実行でき、left、right、displayの調整を簡単にすることができるようになりました。

早速作成した関数を使っていくつかコードを記述してみましょう!!

## 関数の利用
作成した関数を使ってみましょう。

まず初めに当てる年齢の範囲を変化させてみましょう。当てる年齢を9歳として行います。

```python
age = guess_age(left=0, right=10, display=True)
if age != None:
    print(f"あなたの年齢は{age}歳ですね！")
else:
    print('あなたの年齢は与えられた範囲内にはありません。')

```
出力
```python
初めの状態を表示します。
 左端は0です。右端は10です。
現在0回目の繰り返しです。
 左端は0です。右端は10です。真ん中は5です。
現在1回目の繰り返しです。
 左端は6です。右端は10です。真ん中は8です。
現在2回目の繰り返しです。
 左端は9です。右端は10です。真ん中は9です。
あなたの年齢は9歳ですね！

```

引数を調整してみましょう。display=Falseにしてみます。すると処理状態の表示が省略されます。

```python
age = guess_age(left=0, right=10, display=False)
if age != None:
    print(f"あなたの年齢は{age}歳ですね！")
else:
    print('あなたの年齢は与えられた範囲内にはありません。')
```
出力
```python
あなたの年齢は9歳ですね！
```

次に年齢を当てる範囲外の年齢を当てようとした場合どのようになるか見てみましょう。0から５歳までの範囲内で６歳を当てさせようとします。
```python
age = guess_age(left=0, right=5, display=True)
if age != None:
    print(f"あなたの年齢は{age}歳ですね！")
else:
    print('あなたの年齢は与えられた範囲内にはありません。')
```
出力
```python
初めの状態を表示します。
 左端は0です。右端は5です。
現在0回目の繰り返しです。
 左端は0です。右端は5です。真ん中は2です。
現在1回目の繰り返しです。
 左端は3です。右端は5です。真ん中は4です。
現在2回目の繰り返しです。
 左端は5です。右端は5です。真ん中は5です。
あなたの年齢は与えられた範囲内にはありません。
```


このようにプログラムを関数化することで、プログラムの再利用のしやすさ、プログラムの管理のしやすさ、理解しやすさを向上させることができます！
